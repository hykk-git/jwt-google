<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
    <!-- 쿠키 값에 쉽게 접근하게 해주는 라이브러리(js.cookie) -->
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
</head>
<body>
    <h2>로그인</h2>
    <form id="login-form">
        <label>아이디:</label>
        <input type="text" id="username" required>
        <br>
        <label>비밀번호:</label>
        <input type="password" id="password" required>
        <br>
        <button type="submit">로그인</button>
    </form>
    
    <script>
        document.getElementById("login-form").addEventListener("submit", async function(event) {
            event.preventDefault();

            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            // Django의 TokenObtainPairView 실행
            // 사용자의 id pw 받아서 access, refresh token 발급
            // 리턴값: json, refresh = "", access = ""
            const response = await fetch("/api/token/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ username, password })
            });

            const data = await response.json();

            if (response.ok) {
                alert("로그인 성공!");
                // 발급받은 토큰을 쿠키에 저장
                Cookies.set("access", data.access, { expires: 1, path: "/" });
                Cookies.set("refresh", data.refresh, { expires: 7, path: "/" });

                // 로그인 후 main으로 이동
                window.location.href = "/";
            } else {
                alert(data.message || "로그인 실패");
            }
        });
    </script>
</body>
</html>
