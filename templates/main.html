<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>메인 페이지</title>
</head>
<body>
    <h2>메인 페이지</h2>

    <!-- 로그인 여부 확인 -->
    <div id="auth-button">
        <!-- 로그인 상태에 따라 버튼 표시 -->
        <a href="/signup"><button id="signup-btn">회원가입</button></a>
        <a href="/google/login"><button id="login-btn">Google로 로그인</button></a>
        <button id="logout-btn" onclick="logout()">로그아웃</button>
    </div>

    <!-- 게시판으로 이동 버튼 -->
    <div>
        <a href="/board"><button id="board-btn">게시판</button></a>
    </div>

    <script>
        // 쿠키에서 특정 키의 값을 가져오는 함수
        function getCookie(name) {
            const value = `; ${document.cookie}`;  // 쿠키 문자열 앞에 세미콜론 추가
            const parts = value.split(`; ${name}=`);  // 원하는 쿠키 이름으로 분리

            if (parts.length === 2) {
                return parts.pop().split(';').shift();  // 값만 반환
            }
            return null;
        }

        // URL에서 인가 코드 추출
        const params = new URLSearchParams(window.location.search);
        const code = params.get("code");

        if (code) {
                fetch(`/login/oauth2/google/?code=${code}`)
                    .catch(error => {
                        console.error("Login Error:", error);
                    });
            }
        
        const accessToken = getCookie("access_token");
        // accessToken이 있으면 로그인된 사용자라는 것, 로그아웃 버튼 표시
        if (accessToken) {
            document.getElementById("signup-btn").style.display = "none";
            document.getElementById("login-btn").style.display = "none";
            document.getElementById("logout-btn").style.display = "inline-block";
        } else {
            // 없을 경우 로그인이 필요한 사용자, 로그인 버튼 표시
            document.getElementById("signup-btn").style.display = "inline-block";
            document.getElementById("login-btn").style.display = "inline-block";
            document.getElementById("logout-btn").style.display = "none";
        }

        // 로그아웃 함수
        function logout() {
            alert("로그아웃되었습니다.");
            location.reload();
        }

</script>
</body>
</html>
